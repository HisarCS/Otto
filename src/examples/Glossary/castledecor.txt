//Otto by the IdeaLab Fablab

// ========== SHARED PARAMETERS ==========
param materialThickness 30

// ========== CASTLE DOOR: SQUARE WITH SQUARE JOINERY AND INTERNAL RECTANGLES ==========
// ---------- Parameters ----------
param squareSize 300
param joinerySize 28
param joinerySpacing 27
param numJoineryPerSide 6
param internalSquareSize 30
param internalSquareSpacing 40
param internalRowSpacing 50
param internalTopOffset 80

// ---------- Main Square ----------
shape rectangle mainSquare {
  position: [0, 0]
  width: squareSize
  height: squareSize
  fill: false
}

// ---------- Square Joinery Cutouts on All Four Sides (6 per side) ----------
// Top side joinery (6 squares with spacing)
for i from 0 to numJoineryPerSide - 1 {
  param totalWidth (numJoineryPerSide - 1) * (joinerySize + joinerySpacing) + joinerySize
  param startX -totalWidth/2
  param xPos startX + i * (joinerySize + joinerySpacing) + joinerySize/2
  shape rectangle joineryTop {
    position: [xPos, squareSize/2 - joinerySize/2]
    width: joinerySize
    height: joinerySize
    fill: false
  }
}

// Bottom side joinery (6 squares with spacing)
for i from 0 to numJoineryPerSide - 1 {
  param totalWidth (numJoineryPerSide - 1) * (joinerySize + joinerySpacing) + joinerySize
  param startX -totalWidth/2
  param xPos startX + i * (joinerySize + joinerySpacing) + joinerySize/2
  shape rectangle joineryBottom {
    position: [xPos, -squareSize/2 + joinerySize/2]
    width: joinerySize
    height: joinerySize
    fill: false
  }
}

// Left side joinery (4 squares, excluding corners, with spacing)
for i from 1 to numJoineryPerSide - 2 {
  param totalHeight (numJoineryPerSide - 1) * (joinerySize + joinerySpacing) + joinerySize
  param startY -totalHeight/2
  param yPos startY + i * (joinerySize + joinerySpacing) + joinerySize/2
  shape rectangle joineryLeft {
    position: [-squareSize/2 + joinerySize/2, yPos]
    width: joinerySize
    height: joinerySize
    fill: false
  }
}

// Right side joinery (4 squares, excluding corners, with spacing)
for i from 1 to numJoineryPerSide - 2 {
  param totalHeight (numJoineryPerSide - 1) * (joinerySize + joinerySpacing) + joinerySize
  param startY -totalHeight/2
  param yPos startY + i * (joinerySize + joinerySpacing) + joinerySize/2
  shape rectangle joineryRight {
    position: [squareSize/2 - joinerySize/2, yPos]
    width: joinerySize
    height: joinerySize
    fill: false
  }
}

// ---------- Internal Square Cutouts (8 squares in 2 rows of 4) ----------
// Top row (4 squares)
for i from 0 to 3 {
  param xPos -internalSquareSpacing * 1.5 + i * internalSquareSpacing
  param yPos internalTopOffset
  shape rectangle internalTop {
    position: [xPos, yPos]
    width: internalSquareSize
    height: internalSquareSize
    fill: false
  }
}

// Bottom row (4 squares)
for i from 0 to 3 {
  param xPos -internalSquareSpacing * 1.5 + i * internalSquareSpacing
  param yPos internalTopOffset - internalRowSpacing
  shape rectangle internalBottom {
    position: [xPos, yPos]
    width: internalSquareSize
    height: internalSquareSize
    fill: false
  }
}

// ---------- Apply Joinery Cutouts Using Difference ----------
// Apply top joinery cutouts (6 squares)
difference step2 {
  add mainSquare
  add joineryTop_0_0
}

difference step3 {
  add step2
  add joineryTop_1_1
}

difference step4 {
  add step3
  add joineryTop_2_2
}

difference step5 {
  add step4
  add joineryTop_3_3
}

difference step6 {
  add step5
  add joineryTop_4_4
}

difference step7 {
  add step6
  add joineryTop_5_5
}

// Apply bottom joinery cutouts (6 squares)
difference step8 {
  add step7
  add joineryBottom_0_0
}

difference step9 {
  add step8
  add joineryBottom_1_1
}

difference step10 {
  add step9
  add joineryBottom_2_2
}

difference step11 {
  add step10
  add joineryBottom_3_3
}

difference step12 {
  add step11
  add joineryBottom_4_4
}

difference step13 {
  add step12
  add joineryBottom_5_5
}

// Apply left joinery cutouts (4 squares)
difference step14 {
  add step13
  add joineryLeft_1_1
}

difference step15 {
  add step14
  add joineryLeft_2_2
}

difference step16 {
  add step15
  add joineryLeft_3_3
}

difference step17 {
  add step16
  add joineryLeft_4_4
}

// Apply right joinery cutouts (4 squares)
difference step18 {
  add step17
  add joineryRight_1_1
}

difference step19 {
  add step18
  add joineryRight_2_2
}

difference step20 {
  add step19
  add joineryRight_3_3
}

difference step21 {
  add step20
  add joineryRight_4_4
}

// ---------- Apply Internal Rectangle Cutouts Using Difference ----------
// Top row cutouts (4 squares)
difference step22 {
  add step21
  add internalTop_0_0
}

difference step23 {
  add step22
  add internalTop_1_1
}

difference step24 {
  add step23
  add internalTop_2_2
}

difference step25 {
  add step24
  add internalTop_3_3
}

// Bottom row cutouts (4 squares)
difference step26 {
  add step25
  add internalBottom_0_0
}

difference step27 {
  add step26
  add internalBottom_1_1
}

difference step28 {
  add step27
  add internalBottom_2_2
}

difference castledecor {
  add step28
  add internalBottom_3_3
}
